<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>Simple MBtiles Server</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.7.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.7.0/mapbox-gl.css' rel='stylesheet' />
    <style>
        body { margin:0; padding:0; }
        #map { position:absolute; top:0; bottom:0; width:100%; }
    </style>
</head>
<body>

<div id='map'></div>
<script>

    let centre = [153.072510,-27.556981]

    let minzoom = 10
    let maxzoom = 25

    let layerID = 'out'

    let map_style = {
        "version": 8,
        "name": "EmptyStyle",
        "sources": {},
        "layers": [],
        "id": "emptyStyle"
    }

    var map = new mapboxgl.Map({
        container: 'map',
        style: map_style,
        zoom: minzoom,
        center: centre,
        "minZoom": minzoom
    });

    map.on('load', function () {
        map.addSource('tiles', {
                type: 'vector',
                tiles: ['http://127.0.0.1:8765/tiles/{z}/{x}/{y}.pbf'],
                minzoom: minzoom,
                maxzoom: maxzoom
            });
        
            let categories = ["TNC_LG1","TNC_LG2","TNC_LG3","TNC_QR1","TNC_QR2","TNC_QR3","TNC_QR4","TNC_SM0","TNC_SM1","TNC_SM2","TNC_SM3","TNC_SM4","TNC_SV0","TNC_SV1","TNC_SV2","TNC_SV3","TNC_SV4"]
            let colours = ["green", "yellow", "red", "green", "yellow", "red", "purple", "green", "yellow", "orange", "red", "purple", "green", "yellow", "orange", "red", "purple"]
    
            const zip = (arr1, arr2) => arr1.map((k, i) => [k, arr2[i]]);
            let fillColourExpression = ["match", ["get", "OVL2_CAT"]].concat(zip(categories, colours).flat()).concat(["blue"])

            console.log(fillColourExpression)

            let layerType = 'fill'
            map.addLayer({
                "id": layerID,
                "type": layerType,
                "source": 'tiles',
                "source-layer": layerID,
                "paint": {
                    "fill-color": fillColourExpression
                }
            });
    

        map.on('mousemove', function (e) {
            try {
            let feature = map.queryRenderedFeatures(e);
            if (feature) {
                map.getCanvas().style.cursor = 'pointer';
            } else {
                map.getCanvas().style.cursor = 'auto';
            }
            } catch (err) {
             console.error(err);
            }
        });

        map.on('click', layerID, function (e) {
            console.log(e.features[0].properties['OVL2_CAT'])
        })
    });
</script>

</body>
</html>
